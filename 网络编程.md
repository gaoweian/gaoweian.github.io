### 1、什么是Socket
* 网络上的两个程序通过一个双向的通讯连接实现数据的交换，这个双向链路的一端称为一个Socket。Socket通常用来实现客户方和服务方的连接。Socket是TCP/IP协议的一个十分流行的编程界面，一个Socket由一个IP地址和一个端口号唯一确定。
但是，Socket所支持的协议种类也不光TCP/IP一种，因此两者之间是没有必然联系的。在Java环境下，Socket编程主要是指基于TCP/IP协议的网络编程。
### 2、Socket通讯的过程
* Server端Listen(监听)某个端口是否有连接请求，Client端向Server 端发出Connect(连接)请求，Server端向Client端发回Accept（接受）消息。一个连接就建立起来了。Server端和Client 端都可以通过Send，Write等方法与对方通信。
对于一个功能齐全的Socket，都要包含以下基本结构，其工作过程包含以下四个基本的步骤：
    * （1） 创建Socket；
    * （2） 打开连接到Socket的输入/出流；
    * （3） 按照一定的协议对Socket进行读/写操作；
    * （4） 关闭Socket.（在实际应用中，并未使用到显示的close，虽然很多文章都推荐如此，不过在我的程序中，可能因为程序本身比较简单，要求不高，所以并未造成什么影响。）
### 3.创建一个简单的通讯程序
```
//服务器端
package com.sub;

import java.net.*;
import java.io.*;

public class Server {        
   public static void main(String args[]) {
	   ServerSocket s = null;
	   Socket t = null;
	 
	   try{
		   
			//创建服务端，并开通注册端口
			System.out.println("创建成功，正在等待客户端连接");
			s = new ServerSocket(9977);  
			//监听对应端口 阻塞
			System.out.println("等待客户端发送数据");
			t = s.accept();
			//服务端输入流
			System.out.println("正在接收客户端发送数据");
			BufferedReader bf = new BufferedReader(new InputStreamReader(t.getInputStream()));
			String ss = bf.readLine(); 
			System.out.println("服务器:你是");
			System.out.println("客户端:"+ss);//.toString()
			String cc = new String(t.getInetAddress().getHostAddress());
			System.out.println("地址是："+cc); 
			//服务端输出流
			System.out.println("正在向服务器发送数据");
			PrintWriter w = new PrintWriter(t.getOutputStream());
			String sss= "已接收消息"+ss;
			w.write(sss+"\n");
			w.flush();
			bf.close();
			w.close();         
		} catch (Exception e) {
			e.printStackTrace();
		}finally{
			System.out.println("接收结束");
			if(t != null){
				try {
					t.close();
				} catch (IOException e) {
					e.printStackTrace();
				}
			}
			System.out.println("关闭连接");
			if(s != null){
				try {
					s.close();
				} catch (IOException e) {
					e.printStackTrace();
				}
			}
		}
	}    
}   
```
```
//客户端
package com.sub;

import java.io.*;
import java.net.*;
public class Client { 
	public static void main(String[] args){
		Socket t = null;
		try {
			System.out.println("正在连接服务器");
			t = new Socket("127.0.0.1",9977);  
			//客户端输出流
			System.out.println("正在向服务器发送数据");
			PrintWriter w = new PrintWriter(t.getOutputStream());
			String s = "我是张三";
			w.write(s+"\n");
			w.flush();
			//t.shutdownOutput();
			//客户端输入流
			System.out.println("接收服务器返回信息");
			
			BufferedReader bf = new BufferedReader(new InputStreamReader(t.getInputStream()));
			String ss = bf.readLine();
			System.out.println("服务器:" + ss); 
			w.close();
			bf.close();
		} catch (Exception e) {
			e.printStackTrace();
		}finally{
			if(t != null){
				try {
					t.close();
				} catch (IOException e) {
					e.printStackTrace();
				}
			}
		}
	}
}


```
* 注意，在选择端口时，必须小心。每一个端口提供一种特定的服务，只有给出正确的端口，才 能获得相应的服务。0~1023的端口号为系统所保留，例如http服务的端口号为80,telnet服务的端口号为21,ftp服务的端口号为23, 所以我们在选择端口号时，最好选择一个大于8000的数以防止发生冲突。
　　在创建socket时如果发生错误，将产生IOException，在程序中必须对之作出处理。所以在创建Socket或ServerSocket是必须捕获或抛出例外
### 4、支持多客户的client/server程序
* 上面的Client/Server程序只能实现Server和一个客户的对话。实际上它可以接收来自其他多个客户端的请求，提供相应的服务。为了实现在服务器方给多个客户提供服务的功能，需要对上 面的程序进行改造，利用多线程实现多客户机制。
```
//服务器端
package com.GUI;

import java.net.*;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.io.*;

public class Server2 {        
   public static void main(String args[]) {
	   ServerSocket s = null;
	   Socket t = null;
	   List<Socket> list = new ArrayList<Socket>();
	   Map<String,Socket> map = new HashMap<String,Socket>();
	   try{
		   //创建服务端，并开通注册端口
			System.out.println("创建成功，正在等待客户端连接");
			s = new ServerSocket(9999);  
			//监听对应端口 阻塞
			while(true){
				System.out.println("等待客户端发送数据");
				t = s.accept();
				
				BufferedReader bf = new BufferedReader(new InputStreamReader(t.getInputStream()));
				String name = bf.readLine();
				map.put(name,t);
				list.add(t);
				new Thread(new ServerRunnable(t,list,map)).start();	
			}       
		} catch (Exception e) {
			e.printStackTrace();
		}
	}    
}   

```
```
//客户端
package com.dub;

import java.io.*;
import java.net.*;
import java.util.Scanner;
public class Client2 { 
	public static void main(String[] args){
		Socket t = null;
		try {
			System.out.println("正在连接服务器");
			t = new Socket("127.0.0.1",9998 ); 
			PrintWriter printWriter = new PrintWriter(t.getOutputStream());
			printWriter.write("张三\n");
			printWriter.flush();
			//发
			new Thread(new OutRunnable(t)).start();
			//收
			new Thread(new InRunnable(t)).start();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}




```

```
//通过多个线程进行实现
//1.服务器端线程
package com.GUI;

import java.io.*;
import java.net.*;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;



public class ServerRunnable implements Runnable{
	Socket t =null;
	List<Socket> li = null;
	Map<String,Socket> map = null;
	public ServerRunnable(Socket t,List<Socket> li,Map<String, Socket> map){
		this.t = t;
		this.li = li;
		this.map = map;
	}
	public void run(){
		while(true){
			try{
				//服务端输入流
				System.out.println("正在接收客户端发送数据");
				BufferedReader bf = new BufferedReader(new InputStreamReader(t.getInputStream()));
				String ss = null;
				ss = bf.readLine();
				Set<String> keys = map.keySet();
				String name = "";
				for(String s:keys){
					Socket so = map.get(s);
					if(t==so){
						name = s;
					}
				}
				System.out.println("服务器:你是");
				System.out.println("客户端:我是"+name);
				String cc = new String(t.getInetAddress().getHostAddress());
				System.out.println("地址是："+cc); 
				//服务端输出流
				System.out.println("正在客户端发送数据");
				String sss = name+":"+ss;
				for(Socket l:li ){
					PrintWriter w = new PrintWriter(l.getOutputStream());
					w.write(sss+"\n");
					w.flush();
				}		
			}catch(Exception e){
				e.printStackTrace();
			}
		}
	}
}


//客户端输出线程

package com.GUI;

import java.io.*;
import java.io.PrintWriter;
import java.net.Socket;
import java.util.List;
import java.util.Scanner;

public class OutRunnable implements Runnable{
	Socket t =null;
	public OutRunnable(Socket t){
		this.t = t;
	}
	public void run() {
		
		while(true){
			try {
				while(true){
					Scanner sc = new Scanner(System.in);
					try{
						System.out.println("请输入内容:");
						String s = sc.next();
						System.out.println("用户输入的内容是"+s);
						PrintWriter printWriter = new PrintWriter(t.getOutputStream());
						printWriter.write(s+"\n");
						printWriter.flush();
					}catch(Exception e){

					}
				}	
			} catch (Exception e) {
				e.printStackTrace();
			}
			
		}
	}

}


//客户端输入线程

package com.dub;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.Socket;
import java.util.Scanner;

public class InRunnable implements Runnable{
	Socket t =null;
	public InRunnable(Socket t){
		this.t = t;
	}
	public void run() {
		
			while(true){
				try{
					BufferedReader bf = new BufferedReader(new InputStreamReader(t.getInputStream()));
					String ss = bf.readLine();
					System.out.println(ss); 
				}catch (Exception e) {
					e.printStackTrace();
				}
			}
		
	}
}

```
* 实现群聊并显示备注